services:
  backend:
    build:
      context: ./backend
    ports:
      - "8000:8000"
    env_file:
      - ./backend/.env
    profiles:
      - develop
    volumes:
      - ./backend:/app
    # The default command from the Dockerfile is used, which is fine for development.

  frontend:
    build:
      context: ./frontend/web_app
    # The development server runs on port 5173 inside the container.
    # We map it to port 5173 on the host.
    ports:
      - "5173:5173"
    env_file:
      - ./frontend/web_app/.env
    profiles:
      - develop
    volumes:
      - ./frontend/web_app:/app
      # Prevent node_modules from being overwritten by the local empty folder
      - /app/node_modules
    # This command overrides the Dockerfile's CMD to start the dev server.
    command: npm run dev
    depends_on:
      - backend
